<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BPMN User Registration Animation</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: sans-serif;
    }

    #canvas {
      height: 90vh;
      width: 100%;
      border: 1px solid #ccc;
    }

    #controls {
      padding: 10px;
      text-align: center;
    }

    .highlight rect {
      stroke: #ff0000;
      stroke-width: 4;
      fill: #fff3cd !important;
    }
  </style>
</head>
<body>

  <div id="controls">
    <button onclick="startAnimation()">‚ñ∂Ô∏è Run Scenario</button>
    <button onclick="resetAnimation()">üîÅ Reset</button>
  </div>
  <div id="canvas"></div>

  <script src="https://unpkg.com/bpmn-js@18.6.1/dist/bpmn-viewer.development.js"></script>
  <script>
    const viewer = new BpmnJS({ container: '#canvas' });

    const stepIds = [
      'StartEvent',
      'EnterUserData',
      'CheckAge',
      'CheckUsername',
      'CreateAccount',
      'EndEvent'
    ];

    async function loadDiagram() {
      const response = await fetch('diagram.bpmn');
      const xml = await response.text();
      await viewer.importXML(xml);
    }

    async function startAnimation() {
      const elementRegistry = viewer.get('elementRegistry');

      for (let i = 0; i < stepIds.length; i++) {
        clearHighlights();
        const element = elementRegistry.get(stepIds[i]);
        if (element) {
          const gfx = viewer.get('graphicsFactory').getShape(element).gfx;
          gfx.classList.add('highlight');
        }
        await new Promise(resolve => setTimeout(resolve, 5000));
      }
    }

    function resetAnimation() {
      clearHighlights();
    }

    function clearHighlights() {
      document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
    }

    loadDiagram();
  </script>
</body>
</html>
